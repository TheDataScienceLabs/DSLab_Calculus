
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Week 3: Finding Local Max in PPG Signal &#8212; The Data Science Labs on Differential and Integral Calculus</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'labs/2_determine_heart_rate/lab2';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Week 4: Estimate Blood Flow from PPG Data" href="../3_estimate_blood_flow/lab3.html" />
    <link rel="prev" title="Week 2: Introduction to Python, Data Visualization, Sampling/Aliasing" href="../1_intro_to_notebooks/lab1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="The Data Science Labs on Differential and Integral Calculus - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="The Data Science Labs on Differential and Integral Calculus - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    About this Course
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../1_intro_to_notebooks/lab0.html">Week 1: Course Intro, Markdown, Latex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_intro_to_notebooks/lab1.html">Week 2: Introduction to Python, Data Visualization, Sampling/Aliasing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Determine your heart rate</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Week 3: Finding Local Max in PPG Signal</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Estimate your blood flow</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../3_estimate_blood_flow/lab3.html">Week 4: Estimate Blood Flow from PPG Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Measure the heights of tall and far away things</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../4_measure_tall_things/a_prepare_for_building_inclinometer/lab4a.html">Week 5: Prep to Build an Inclinometer (Namespaces, Modules, Objects)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_measure_tall_things/b_build_an_inclinometer/lab4b.html">Week 6-7: Build an Inclinometer (Objects on Hardware)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_measure_tall_things/c_make_the_measurements/lab4c.html">Week 8-9: Measure Heights of Campus Landmarks with Your Inclinometer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_measure_tall_things/d_error_analysis/lab4d.html">Week 10: How Accurate is Your Height Measurement? (Derivative Rule for Error Propagation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_measure_tall_things/e_symbolic_error/lab4e.html">Week 11: Analyzing the Error Using Symbolic Method (SymPy)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Measure the speeds of nearby things</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../5_measure_speeds/a_derivatives/lab5a.html">Week 12: Prepare to Build a Distance Measurement Tool (Floating Pt Numbers and Num. Differentiation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5_measure_speeds/b_build_a_tool/lab5b.html">Week 13: Build a Distance Measurement Distance Tool Using an Ultrasonic Sensor (Data Cleaning and Micropython)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Design a project of your own</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../final_project/labfinal.html">Weeks 14-15: Final Project</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extra Materials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../extra_materials/intro_to_breadboards/intro_to_breadboards.html">Extra Materials: Introduction to Breadboards</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/TheDataScienceLabs/DSLab_Calculus" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/TheDataScienceLabs/DSLab_Calculus/issues/new?title=Issue%20on%20page%20%2Flabs/2_determine_heart_rate/lab2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/labs/2_determine_heart_rate/lab2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Week 3: Finding Local Max in PPG Signal</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#content"><span style="color:orange;"> 00. Content </span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#required-hardware"><span style="color:orange;"> 0. Required Hardware </span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-error-analysis"><span style="color:orange;"> 1. Introduction to error analysis </span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#types-of-error">Types of error</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-10-pts"><span style="color:red;"> Exercise 1 </span> (10 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-ways-errors-behave">Two ways errors behave</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#random-error">Random error</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#systematic-error">Systematic error</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-10-pts"><span style="color:red;"> Exercise 2 </span> (10 pts)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-acquisition"><span style="color:orange;"> 2. Data Acquisition </span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-10-pts"><span style="color:red;"> Exercise 3 </span> (10 pts)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-firmware-onto-the-microcontroller">Loading firmware onto the microcontroller</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#make-sure-to-read-the-next-steps-carefully">(Make sure to read the next steps carefully!!)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wiring-it-up">Wiring it up</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acquiring-data">Acquiring data!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis"><span style="color:orange;"> 3. Analysis </span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-10-pts"><span style="color:red;"> Exercise 4 </span> (10 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-5-10-pts"><span style="color:red;"> Exercise 5 </span> (10 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#that-s-all-for-today">That’s all for today!</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="week-3-finding-local-max-in-ppg-signal">
<h1>Week 3: Finding Local Max in PPG Signal<a class="headerlink" href="#week-3-finding-local-max-in-ppg-signal" title="Link to this heading">#</a></h1>
<p><font size="6"> Laboratory 2  </font> <br>
<font size="3"> Last updated September 9, 2023</font></p>
<section id="content">
<h2><span style="color:orange;"> 00. Content </span><a class="headerlink" href="#content" title="Link to this heading">#</a></h2>
<p><font size="5"> Mathematics </font></p>
<ul class="simple">
<li><p>Additive error model; bias in error</p></li>
<li><p>Noise removal by averaging</p></li>
<li><p>Finding local maxima as “peaks”</p></li>
<li><p>Choosing a sampling rate based on distance between local maxima</p></li>
<li><p>Local maxima defined as location between function increase and decrease</p></li>
<li><p>Thresholding</p></li>
<li><p>Computing beats per minutes (BMP) from peaktimes</p></li>
</ul>
<p><font size="5"> Programming Skills </font></p>
<ul class="simple">
<li><p>Best practice: use separate data file and analysis file</p></li>
<li><p>Use/modify given Python data acquisition code</p></li>
<li><p>Save data in text file</p></li>
<li><p>Load data from text file</p></li>
<li><p>Look at loaded data</p></li>
<li><p>Plotting data</p></li>
<li><p>Changing x-axis in a plot</p></li>
<li><p>Array building</p></li>
<li><p>Zooming into plot</p></li>
<li><p>Use of averaging code</p></li>
<li><p>Use of local maxima identify code</p></li>
<li><p>NaN</p></li>
<li><p>Use of thresholding code</p></li>
<li><p>Write code to compute beats per minutes (BMP) from peaktimes</p></li>
</ul>
<p><font size="5"> Embedded Systems </font></p>
<ul class="simple">
<li><p>Thonny and Micropython</p></li>
<li><p>Installing Micropython on Pico</p></li>
</ul>
</section>
<section id="required-hardware">
<h2><span style="color:orange;"> 0. Required Hardware </span><a class="headerlink" href="#required-hardware" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Microcontroller: Raspberry Pi Pico</p></li>
<li><p>Pulse sensor</p></li>
<li><p>Ceramic Capacitor</p></li>
<li><p>Breadboard</p></li>
<li><p>USB connector</p></li>
</ul>
<h3 style="background-color:lightblue"> Write your name and email below: </h3>
<p>First Name, Last Name, email</p>
</section>
<section id="introduction-to-error-analysis">
<h2><span style="color:orange;"> 1. Introduction to error analysis </span><a class="headerlink" href="#introduction-to-error-analysis" title="Link to this heading">#</a></h2>
<blockquote>
<div><p>In order to improve, we must first recognize that we are not perfect.</p>
</div></blockquote>
<p>Today we will begin using numbers collected from the real world. Every number you measure is subject to several kinds of error from different sources. This is the first and most important lesson of error analysis: <em>every measurement has error. The goal is not to eliminate error, but rather to reduce it to an acceptable level.</em> As we progress through the semester, we will develop strong tools for analyzing and reducing error in our measurements, based off of differential calculus and Taylor series. Before we can do that, we need to establish some common language and techniques for describing errors.</p>
<section id="types-of-error">
<h3>Types of error<a class="headerlink" href="#types-of-error" title="Link to this heading">#</a></h3>
<p>An error is anything which can make it so that the number you get is different from the actual value of the quantity you are measuring. Here are a few sources of error you are likely to encounter:</p>
<ul class="simple">
<li><p>measurement error. This is what most people think of when they hear about an error in measurement. This includes everything which could go wrong with your measurement instrument. Perhaps the marks on a ruler are not placed exactly evenly, or it isn’t being held straight. Perhaps the paralax on a measurement dial leads to misalignment between the needle and the dial. Perhaps your tool is low on batteries and is malfunctioning.</p></li>
<li><p>roundoff error. Also called truncation error. This is where a number is off a little bit because it was rounded. For example, Alden’s favorite pocket calculator the TI-30Xa only keeps 14 digits of <span class="math notranslate nohighlight">\(\pi\)</span>. If you needed <span class="math notranslate nohighlight">\(\pi\)</span> to any further precision, you would have to use a different calculator. Usually the cure for this source of error is fairly simple – just keep more digits! However, this is not always practical: maybe you are using numbers someone else has rounded and cannot access the original data, or maybe keeping enough digits for your task would be too cumbersome. We will see some examples in a few weeks, when we study numerical differentiation, where roundoff error becomes really important.</p></li>
<li><p>modeling error. Every computation is based on a model, and every model is inaccurate. For example, suppose you want to measure the volume of the earth. You could perform astronomical measurements to figure out the radius of the earth, and use the volume formula for a sphere, <span class="math notranslate nohighlight">\(\frac{4}{3} \pi r^3\)</span> to figure out the volume. The formula is perfect, without error, provided you are talking about a true sphere. As anyone knows, however, the earth is not a perfect sphere (it has mountains, for one thing). Therefore, there is some error associated with modeling the earth as a perfect sphere, which will affect your final volume computation.</p></li>
<li><p>definitional error. This is perhaps the most frequently overlooked source of error, and its definition gets a bit philosophical. Usually we can’t get to a level where it is important in the physical sciences, though it is frequently important in the social sciences. As an example, consider the old unit of length, the barleycorn. This is still used today to measure shoe sizes. Its definition could not be simpler: it’s the length of a grain of barley, roughly 1/3 of an inch or 8.5 millimeters. There is a problem here though: barley has some natural variablility of size, from 6.4 millimeters at the smallest to 13 millimeters at the longest <a class="reference external" href="https://www.agriculturejournals.cz/publicFiles/10118.pdf">(see this study if you want to know more about barley)</a>. So, depending on which type of barley you are using, your shoe could wind up being a bad fit. It’s not a matter of the barley being a bad tool for measuring length in barleycorns: you can always tell exactly how long something is in barleycorns by lining up a row of barley, and you will be correct by definition. It’s a problem with the definition of the length unit – the definition has some error built in. This usually doesn’t affect us when making distance measurements, since we have better definitions now for length, based off the speed of light and our definition of time. However, for very sensitive measurements, it is still sometimes an issue. Furthermore, for more abstractly defined quantities (such as intelligence, or anxiety, or pain) the definition still has a significant amount of error built in which can sometimes be the biggest source of error in a computation.</p></li>
</ul>
<p>This is a relatively simple taxonomy of errors, but it encompasses most of the important sources of error you are likely to encounter. If you can think of a source of error which does not fit this taxonomy, we would like to hear about it (email mboutin at purdue dot you know what). As we will see, you could waste a lot of effort reducing the error from one source only to find that a different source is introducing way more error, making your efforts fruitless. Therefore, it is important to be aware of how each source of error could creep in.</p>
</section>
<section id="exercise-1-10-pts">
<h3><span style="color:red;"> Exercise 1 </span> (10 pts)<a class="headerlink" href="#exercise-1-10-pts" title="Link to this heading">#</a></h3>
<p>For each source of error listed, classify it according to the taxonomy above. Explain why it fits into the category you chose.</p>
<ol class="arabic simple">
<li><p>You have a thermometer in your garden which you use to tell the temperature in the morning. The sun shines directly on the thermometer, making it read a temperature higher than the air temperature.</p></li>
<li><p>You use a tire pressure gauge to figure out the pressure in your car tires. It only has a marking every 2 PSI, so you do your best to estimate the value to the nearest PSI.</p></li>
<li><p>You use a GPS system to track how long your commute is, but it only takes into account longitude and latitude, not elevation.</p></li>
</ol>
<h3 style="background-color:lightblue"> Write Answers for Exercise 1 Below </h3></section>
<section id="two-ways-errors-behave">
<h3>Two ways errors behave<a class="headerlink" href="#two-ways-errors-behave" title="Link to this heading">#</a></h3>
<p>We usually represent error with a variable either as <span class="math notranslate nohighlight">\(e\)</span> (short for error), or in Greek with the lower case letter epsilon which makes the same sound, written as either <span class="math notranslate nohighlight">\(\epsilon\)</span> or <span class="math notranslate nohighlight">\(\varepsilon\)</span>. This lets us represent how any measured quantity <span class="math notranslate nohighlight">\(x\)</span> is related to its “true value” <span class="math notranslate nohighlight">\(t\)</span>:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
x = t + \varepsilon.
\end{align*}\]</div>
<p>This is sometimes called <em>the most famous equation of measurement theory</em>.</p>
<section id="random-error">
<h4>Random error<a class="headerlink" href="#random-error" title="Link to this heading">#</a></h4>
<p>Our goal is usually to make the total error small. For some types of error, <span class="math notranslate nohighlight">\(\varepsilon\)</span> is on average zero; the error is just as often positive as it is negative. A consequence of this is that if you took lots and lots of measurements (say <span class="math notranslate nohighlight">\(x_1=t+\varepsilon_1\)</span>, <span class="math notranslate nohighlight">\(x_2=t+\varepsilon_2\)</span>, <span class="math notranslate nohighlight">\(\dots\)</span>, <span class="math notranslate nohighlight">\(x_k=t+\varepsilon_k\)</span>) then you could take the average</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{x_1+x_2+\dots+x_k}{k} = t + \frac{\varepsilon_1+\varepsilon_2+\dots+\varepsilon_k}{k}
\end{align*}\]</div>
<p>and the term <span class="math notranslate nohighlight">\(\frac{\varepsilon_1+\varepsilon_2+\dots+\varepsilon_k}{k}\)</span> would tend to be much smaller than each <span class="math notranslate nohighlight">\(\varepsilon_i\)</span> on its own, since the positive and negative terms would mostly cancel each other out. This is really useful, since it gives us a way of reducing the total error, getting a better estimate of the value <span class="math notranslate nohighlight">\(t\)</span>. If this is the case, we say that the error in <span class="math notranslate nohighlight">\(x\)</span> is <em>random</em>. This technique for reducing random error <a class="reference external" href="https://www.math.purdue.edu/~bradfoa/misc_files/arithmetic_mean.pdf">was invented in the 1700s.</a> (See  for example page 121 of “Studies in the History of Statistics and Probability,” by M.G. Kendall, 1960.)</p>
</section>
<section id="systematic-error">
<h4>Systematic error<a class="headerlink" href="#systematic-error" title="Link to this heading">#</a></h4>
<p>Unfortunately, we are often not so lucky as to only have random error. Very often there is some bias in our measurement which causes it to be usually positive or usually negative, so it does not help much to use the repeated measurement procedure described above. In this case we say there is a <em>systematic</em> error.</p>
<p>For example, let’s say you decide to save some computer cycles in a computation by truncating your numbers – instead of rounding (which could take some additional time, depending on how your computer is set up) you decide to just drop the least significant digits. The effect of this is that you will always be making the number smaller. It’s just like if you always decided to round down. In the terms outlined above, <span class="math notranslate nohighlight">\(\varepsilon\)</span> is always negative in this case.</p>
<p>As another example, suppose you are weighing precise amounts of material in a chemistry lab on a sensitive scale, but you don’t have a cover over the scale and there is a slight downdraft at the work bench. You are leaning over the scale when you hit the tare button, shielding the scale from the air current. The air would push down on the scale a bit during the weighting, causing your estimated weight <span class="math notranslate nohighlight">\(x\)</span> to usually be a little bit bigger than <span class="math notranslate nohighlight">\(t\)</span>. It would still vary randomly, but since <span class="math notranslate nohighlight">\(\varepsilon\)</span> would usually be positive we would say that this is a systematic error in the positive direction.</p>
</section>
</section>
<section id="exercise-2-10-pts">
<h3><span style="color:red;"> Exercise 2 </span> (10 pts)<a class="headerlink" href="#exercise-2-10-pts" title="Link to this heading">#</a></h3>
<p>For each source of error described, classify it as a random or a systematic error. If it is a systematic error, say whether it is in the positive or negative direction. Justify your answers with a brief sentence or two.</p>
<ol class="arabic simple">
<li><p>You are measuring your height against a wall by placing a book on your head and seeing where the book touches the wall, measuring the length along the wall from the floor with a tape measure. Unfortunately, you cannot guarantee that the book is completely level.</p></li>
<li><p>You make sure the book from problem 1 is level by placing one edge vertically along the wall, measuring from there to the base of the wall. Unfortunately, the wall is very slightly sloped toward you.</p></li>
<li><p>You have a thermometer in your garden which you use to tell the temperature in the morning. The sun shines directly on the thermometer.</p></li>
<li><p>You use a tire pressure gauge to figure out the pressure in your car tires. It only has a marking every 2 PSI, so you do your best to estimate the value to the nearest PSI.</p></li>
<li><p>You use a GPS system to track how long your commute is, but it only takes into account longitude and lattitude, not elevation.</p></li>
</ol>
<h3 style="background-color:lightblue"> Write Answers for Exercise 2 Below </h3></section>
</section>
<section id="data-acquisition">
<h2><span style="color:orange;"> 2. Data Acquisition </span><a class="headerlink" href="#data-acquisition" title="Link to this heading">#</a></h2>
<p>You will collect data today using the <a class="reference external" href="https://www.analog.com/media/en/technical-documentation/data-sheets/max30102.pdf">MAX30102 heart rate sensor module</a>, which shines an invisible infrared light on your skin and measures how much comes back to get a number which is proportional to your blood pressure. After we have collected the data, we will analyze it using NumPy and Matplotlib. First, though, we have to get those numbers onto your computer.</p>
<p>We will be acquiring the data using a microcontroller. A microcontroller is a very small general purpose computer good at communicating with electronic sensors. The specific microcontroller we will use is called the Raspberry Pi Pico. Conveniently, it runs Python code.</p>
<section id="exercise-3-10-pts">
<h3><span style="color:red;"> Exercise 3 </span> (10 pts)<a class="headerlink" href="#exercise-3-10-pts" title="Link to this heading">#</a></h3>
<p>Before moving on, we should decide on a sampling frequency – that is, how often do you want to know your approximate blood pressure? As we saw in Lab 1, it would be easy to get the wrong impression from an oscillating signal if you don’t sample frequently enough. Considering the range of possible heart rates for adults, how would you choose the sampling rate?  Write your choice below, along with your reasoning for choosing that sampling rate.</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 3 Below </h3></section>
</section>
<section id="loading-firmware-onto-the-microcontroller">
<h2>Loading firmware onto the microcontroller<a class="headerlink" href="#loading-firmware-onto-the-microcontroller" title="Link to this heading">#</a></h2>
<section id="make-sure-to-read-the-next-steps-carefully">
<h3>(Make sure to read the next steps carefully!!)<a class="headerlink" href="#make-sure-to-read-the-next-steps-carefully" title="Link to this heading">#</a></h3>
<p>First, ask your TA for today’s hardware and pull out your pico. Find the BOOTSEL button (see the below diagram), press and hold it down, and then plug in your pico while continuing to hold the button. After 5 seconds, you can let go of the button. Next, <a class="reference external" href="https://micropython.org/resources/firmware/RPI_PICO-20220618-v1.19.1.uf2">click this link</a> to download the Micropython firmware. Navigate to your downloads folder, and find the <code class="docutils literal notranslate"><span class="pre">.uf2</span></code> file that was just downloaded and drag it into the pico folder, which can be found on the left side panel called <code class="docutils literal notranslate"><span class="pre">/RPI-RP2</span></code>. After a second or two, the pico should reboot, and the <code class="docutils literal notranslate"><span class="pre">/RPI-RP2</span></code> folder will go away. After a few more seconds, open up thonny, and press the button in the bottom right, which may say something like “Python 3.x.x”, “Micropython”, or “Select interpreter”. A pop up window should come up, in that window select <code class="docutils literal notranslate"><span class="pre">Micropython</span></code>, then press done. The terminal in thonny will probably have an error at this point, if so just rapidly click the Stop/Restart button in the top bar, which looks like a red stop sign. If the red message doesn’t go away after about 30 seconds of clicking, double check you followed the steps correctly, then ask your TA if the problem persists.</p>
<div>
<img src="https://raw.githubusercontent.com/TheDataScienceLabs/DSLab_Calculus/main/book/labs/2_determine_heart_rate/pico_bootsel.png" alt="bootsel button diagram" width="400"/>
</div>
<p>Our next step is to copy and paste <a class="reference external" href="https://raw.githubusercontent.com/TheDataScienceLabs/DSLab_Calculus/main/book/labs/2_determine_heart_rate/main.py">this code</a> into thonny, and save it onto the Pico as <code class="docutils literal notranslate"><span class="pre">main.py</span></code>. Now, whenever you plug in the pico, it will run <code class="docutils literal notranslate"><span class="pre">main.py</span></code> automatically.</p>
<p>Then run the following cell. This will download a folder called <code class="docutils literal notranslate"><span class="pre">max30102/</span></code> into your Downloads folder. After you have done that, pull up thonny, and on the top bar under ‘View’, select ‘Files’. This will bring up a bar on the side that you can use to transfer the file onto your Pico. In this side bar, navigate to your Downloads folder (If you get lost, you can find it at <code class="docutils literal notranslate"><span class="pre">This</span> <span class="pre">Computer/home/shay/a/&quot;your</span> <span class="pre">username&quot;/Downloads</span></code>), right click the <code class="docutils literal notranslate"><span class="pre">max30102/</span></code> folder, then press ‘Upload to /’. This will copy the entire folder onto your Pico.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sh</span>
cd ~/Downloads
if [ -d &quot;./max30102/&quot; ]; then
    rm -r &quot;./max30102&quot;
fi
mkdir max30102
cd max30102
wget -q -N https://raw.githubusercontent.com/TheDataScienceLabs/DSLab_Calculus/main/book/labs/2_determine_heart_rate/max30102/circular_buffer.py
wget -q -N https://raw.githubusercontent.com/TheDataScienceLabs/DSLab_Calculus/main/book/labs/2_determine_heart_rate/max30102/__init__.py
cd ..
</pre></div>
</div>
</div>
</div>
<p>Next, run the following block to download the <a class="reference external" href="http://heartbeat.py">heartbeat.py</a> module, which we will use later</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sh</span>
wget -q -N https://raw.githubusercontent.com/TheDataScienceLabs/DSLab_Calculus/main/book/labs/2_determine_heart_rate/heartbeat.py
</pre></div>
</div>
</div>
</div>
</section>
<section id="wiring-it-up">
<h3>Wiring it up<a class="headerlink" href="#wiring-it-up" title="Link to this heading">#</a></h3>
<p>We have the computer talking to the microcontroller, now we just need the Heart Rate Sensor talking to the microcontroller. To do this, we will use a “bread board”. The name “bread board” comes from the old days of electronics when people would prototype their projects by nailing them to a cutting board. With a modern bread board, you don’t need nails.</p>
<p>By inserting the entire Pico into your bread board, we can easily connect electrical wires to each of the pins of the Pico. First, <strong>disconnect the Pico from your computer</strong> and plug it into the bread board so that the USB plug is at the end of the bread board.</p>
<p>Next, inspect the data sheet for the Pico (<a class="reference external" href="https://datasheets.raspberrypi.com/pico/pico-datasheet.pdf">pico_datasheet.pdf</a> - also save this PDF in the main folder you’re using since it’ll continue to be handy throughout this course). Specifically, look for figure 2 on page 4. Then use the following table to make all the correct connections.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Pico</p></th>
<th class="head"><p>MAX30102 Sensor</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GND</p></td>
<td><p>GND</p></td>
</tr>
<tr class="row-odd"><td><p>3V3(OUT)</p></td>
<td><p>VIN</p></td>
</tr>
<tr class="row-even"><td><p>I2C0 SDA <em>(Pin 1)</em></p></td>
<td><p>SDA</p></td>
</tr>
<tr class="row-odd"><td><p>I2C0 SCL <em>(Pin 2)</em></p></td>
<td><p>SCL</p></td>
</tr>
</tbody>
</table>
</div>
<p>You will also be provided with a small ceramic capacitor. This should be placed in between the GND and the 3V3(OUT) pins on the pico, in any orientation. <em>(see the third picture below)</em></p>
<p>While we have provided some reference pictures below, we encourage you to mainly rely on the table above, rather than the pictures. Ask a TA or a classmate if you have questions about the wiring.</p>
<p><img alt="sensor pins" src="https://github.com/TheDataScienceLabs/DSLab_Calculus/blob/main/book/labs/2_determine_heart_rate/sensor_pins.png?raw=true" />
<img alt="wiring example" src="https://github.com/TheDataScienceLabs/DSLab_Calculus/blob/main/book/labs/2_determine_heart_rate/wiring_example.jpg?raw=true" />
<img alt="capacitor placement" src="https://github.com/TheDataScienceLabs/DSLab_Calculus/blob/main/book/labs/2_determine_heart_rate/capacitor_placement.jpg?raw=true" /></p>
<p><strong>At this point, check with your instructor to make sure you have it configured correctly.</strong> If it is wired incorrectly, there is a chance that powering it on could damage either the Pico or the Pulse Sensor.</p>
<p>Once you have checked with your instructor, you can plug the Pico into your computer and move on to the next step.</p>
</section>
</section>
<section id="acquiring-data">
<h2>Acquiring data!<a class="headerlink" href="#acquiring-data" title="Link to this heading">#</a></h2>
<p><strong>Read this carefully!</strong> Now we are ready to acquire the data. Be careful while following these steps, as not following them properly could lead to the lab failing to acquire data. Pull up Thonny and run <a class="reference external" href="https://raw.githubusercontent.com/TheDataScienceLabs/DSLab_Calculus/main/book/labs/2_determine_heart_rate/main.py">main.py</a> (which should have been saved onto the pico earlier using the <code class="docutils literal notranslate"><span class="pre">run</span></code> button in Thonny. The run button will look like a green arrow, located towards the top of your application. Once you press run, select <code class="docutils literal notranslate"><span class="pre">disconnect</span></code> from  a couple seconds afterwards. The <code class="docutils literal notranslate"><span class="pre">disconnect</span></code> button can be found in the <code class="docutils literal notranslate"><span class="pre">run</span></code> menu at the top of the application. This will allow our program here to pick up the connection, putting the data directly into a plot. Go ahead and run the following block to start our graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">heartbeat</span><span class="w"> </span><span class="kn">import</span> <span class="n">acquire</span>
<span class="o">%</span><span class="k">matplotlib</span> widget

<span class="n">sampling_rate</span> <span class="o">=</span> <span class="mi">200</span> <span class="c1"># samples per second</span>
<span class="n">sampling_duration</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># seconds</span>
<span class="n">number_of_samples</span> <span class="o">=</span> <span class="n">sampling_rate</span> <span class="o">*</span> <span class="n">sampling_duration</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">number_of_samples</span><span class="p">)</span><span class="o">/</span><span class="n">sampling_rate</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">line</span><span class="p">,</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sampling_duration</span><span class="p">)</span>

<span class="c1"># setting the lower and upper limits of the y-axis</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000</span><span class="p">)</span> <span class="c1"># ADJUST THIS HERE until you can identify your heartbeat</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Next, run the following cell. Notice that this cell has a <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True</span></code> loop in it, which will continue to acquire data until we decide to stop it. Place your finger on the sensor module, and see if you can see movement on the graph above. <strong>Notice here</strong> that the graph will probably look pretty flat, this is because we are zoomed out quite a bit on the y axis. Adjust the second to last line of the code block above until you can notice your heartbeat in the graph. Once the graph of your heart rate looks pretty constant, go ahead and click the stop button at the top of this window (the dark gray square) when the readings reach the right side of the graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">acquire</span><span class="p">(</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">number_of_samples</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done acquiring!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Re-run the above cell as many times as you need to get a good, clean measurement which shows a clear heartbeat pattern. On me, it looks something like this:</p>
<p><img alt="example heartbeat" src="https://github.com/TheDataScienceLabs/DSLab_Calculus/blob/main/book/labs/2_determine_heart_rate/data_example.png?raw=true" /></p>
<p><strong>This is important:</strong> Once you have a good measurement, run the following cell to save your measurement to a file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;heartbeat.txt&#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This sensor sometimes has difficulty getting a reading for some people. While we do not know exactly what factors contribute to this, there are plenty of reasons it might not work, including skin quality, natural oil, applied oils, and even skin color might be impacting the results. As such, if you are not able to get a reading after a few tries, use the <a class="reference external" href="https://raw.githubusercontent.com/TheDataScienceLabs/DSLab_Calculus/main/book/labs/2_determine_heart_rate/example_heartbeat.txt">example_heartbeat.txt</a> file for the rest of the lab.</p>
<p>Have a look at the file you just made - or the example file, if needed (you should be able to open it right here in Jupyterlab). You should see a long list of numbers.</p>
<p>It is a very good practice to use a separate document to store your data. By not storing your data within the document you use to analyze it, you will be able to run your analysis several times without fear of changing your original data. For this reason, we have saved another copy of your results above to a file named ‘heartbeat.txt’</p>
</section>
<section id="analysis">
<h2><span style="color:orange;"> 3. Analysis </span><a class="headerlink" href="#analysis" title="Link to this heading">#</a></h2>
<p>Here is how to load your data file back into Python:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;heartbeat.txt&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="mi">20</span><span class="p">])</span>  <span class="c1"># show me just the first 20 entries</span>
</pre></div>
</div>
</div>
</div>
<p>A good first step for understanding data is to visualize it – that is, make a plot. Before that, we will call <code class="docutils literal notranslate"><span class="pre">%matplotlib</span> <span class="pre">inline</span></code> to change out of interactive plotting mode.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Unfortunately the x-axis is all wrong – it is just counting measurements one by one, not giving us the actual time of each measurement. To fix this, we can make an array which has the time each measurement was taken.</p>
<section id="exercise-4-10-pts">
<h3><span style="color:red;"> Exercise 4 </span> (10 pts)<a class="headerlink" href="#exercise-4-10-pts" title="Link to this heading">#</a></h3>
<p>Make an array called <code class="docutils literal notranslate"><span class="pre">t</span></code> which has the time corresponding to each measurement. We need an array that can function as the values for the x-axis. If you feel stuck, look at the previous notebook for inspiration.</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 4 Below </h3><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="c1"># create your array here</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now we will zoom in to see just the first second. You can use the command <code class="docutils literal notranslate"><span class="pre">plt.xlim</span></code>. To understand what the command does and the required arguments, we can call  <span class="math notranslate nohighlight">\(\mathtt{help()}\)</span>, Python’s built in help system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we see that to call this function, we just need to give it a left and right endpoint as arguments.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>There is some jaggedness to the signal. This is present because the Pulse Sensor has some noise in its circuitry – it introduces some random error. We can get rid of it using the same trick we always use to manage random error: averaging. Specifically, we can average each point with its neighbors. The following code averages each point with its ten nearest neighbors on each side, then plots the result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">heartbeat</span><span class="w"> </span><span class="kn">import</span> <span class="n">rolling_centered_average</span>

<span class="n">averaged</span> <span class="o">=</span> <span class="n">rolling_centered_average</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">averaged</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that the signal is smoother, but there is still some unwanted jiggle to it. Increase the number of terms in the average until it goes up and down smoothly and only peaks at the highest points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">averaged</span> <span class="o">=</span> <span class="n">rolling_centered_average</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">)</span>  <span class="c1"># You fill in an appropriate number</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">averaged</span><span class="p">)</span>
<span class="c1">#plt.xlim(0.1, 2.1)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Our main objective is to identify the frequency of this signal – that is, the heart rate. To do that, let’s see if we can mark the local maxima. Here is an example of a function which will identify those points where the function is increasing (where the current value is bigger than the previous). It may give a warning about invalid values – that’s because we don’t have any good average values for the values at the ends, so they are filled in with the “not a number” value, <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">increasing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
    <span class="n">averaged</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span>
<span class="p">)</span>  <span class="c1"># this creates an array filled with False</span>
<span class="n">increasing</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">averaged</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&gt;</span> <span class="n">averaged</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">averaged</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">increasing</span><span class="p">],</span> <span class="n">averaged</span><span class="p">[</span><span class="n">increasing</span><span class="p">],</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can see where it is decreasing by looking at the complement. Make a plot similar to the above, showing where the function is decreasing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">decreasing</span> <span class="o">=</span> <span class="o">~</span><span class="n">increasing</span>

<span class="c1"># You make a plot here, similar to the above (this is not graded, but will help make sure everything is working)</span>
</pre></div>
</div>
</div>
</div>
<p>Now it is just a matter of finding where the switch occurs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maxima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">averaged</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">maxima</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">increasing</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">decreasing</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">averaged</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">maxima</span><span class="p">],</span> <span class="n">averaged</span><span class="p">[</span><span class="n">maxima</span><span class="p">],</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we can remove any smaller wobbles by using a threshold – only counting maxima above a certain value. This will get us only those top peaks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">peak_indices</span> <span class="o">=</span> <span class="n">maxima</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">averaged</span> <span class="o">&gt;</span> <span class="n">averaged</span><span class="p">[</span><span class="n">maxima</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">averaged</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">peak_indices</span><span class="p">],</span> <span class="n">averaged</span><span class="p">[</span><span class="n">peak_indices</span><span class="p">],</span> <span class="s2">&quot;o&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have identified the peaks, we can take the times these have occurred and compute the BPM.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">peak_times</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">peak_indices</span><span class="p">]</span>
<span class="n">peak_times</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-5-10-pts">
<h3><span style="color:red;"> Exercise 5 </span> (10 pts)<a class="headerlink" href="#exercise-5-10-pts" title="Link to this heading">#</a></h3>
<p>Use the peak times to compute your BPM.</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 5 Below </h3></section>
<section id="that-s-all-for-today">
<h3>That’s all for today!<a class="headerlink" href="#that-s-all-for-today" title="Link to this heading">#</a></h3>
<p>Well done! Today we learned a bit about the terminology of error analysis, we learned how to interface with a microcontroller using Python, and we developed a procedure for computing the BPM from a photoplethysmogram sensor. In next week’s lab, we will learn how to make that process automatic, and do a more sophisticated analysis of the data you collected today.</p>
<p>Make sure you save the code you wrote today, because you will need it next week (you can hit the save button at the top of the notebook). Then, make sure to submit your notebook you used today to Gradescope.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./labs/2_determine_heart_rate"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../1_intro_to_notebooks/lab1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Week 2: Introduction to Python, Data Visualization, Sampling/Aliasing</p>
      </div>
    </a>
    <a class="right-next"
       href="../3_estimate_blood_flow/lab3.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Week 4: Estimate Blood Flow from PPG Data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#content"><span style="color:orange;"> 00. Content </span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#required-hardware"><span style="color:orange;"> 0. Required Hardware </span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-error-analysis"><span style="color:orange;"> 1. Introduction to error analysis </span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#types-of-error">Types of error</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-10-pts"><span style="color:red;"> Exercise 1 </span> (10 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-ways-errors-behave">Two ways errors behave</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#random-error">Random error</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#systematic-error">Systematic error</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-10-pts"><span style="color:red;"> Exercise 2 </span> (10 pts)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-acquisition"><span style="color:orange;"> 2. Data Acquisition </span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-10-pts"><span style="color:red;"> Exercise 3 </span> (10 pts)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-firmware-onto-the-microcontroller">Loading firmware onto the microcontroller</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#make-sure-to-read-the-next-steps-carefully">(Make sure to read the next steps carefully!!)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wiring-it-up">Wiring it up</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acquiring-data">Acquiring data!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis"><span style="color:orange;"> 3. Analysis </span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-10-pts"><span style="color:red;"> Exercise 4 </span> (10 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-5-10-pts"><span style="color:red;"> Exercise 5 </span> (10 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#that-s-all-for-today">That’s all for today!</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mireille Boutin, Alden Bradford
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>