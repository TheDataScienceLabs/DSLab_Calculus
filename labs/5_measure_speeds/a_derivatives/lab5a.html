
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Week 12: Prepare to Build a Distance Measurement Tool (Floating Pt Numbers and Num. Differentiation) &#8212; The Data Science Labs on Differential and Integral Calculus</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'labs/5_measure_speeds/a_derivatives/lab5a';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Week 13: Build a Distance Measurement Distance Tool Using an Ultrasonic Sensor (Data Cleaning and Micropython)" href="../b_build_a_tool/lab5b.html" />
    <link rel="prev" title="Week 11: Analyzing the Error Using Symbolic Method (SymPy)" href="../../4_measure_tall_things/e_symbolic_error/lab4e.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.png" class="logo__image only-light" alt="The Data Science Labs on Differential and Integral Calculus - Home"/>
    <script>document.write(`<img src="../../../_static/logo.png" class="logo__image only-dark" alt="The Data Science Labs on Differential and Integral Calculus - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    About this Course
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../1_intro_to_notebooks/lab0.html">Week 1: Course Intro, Markdown, Latex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../1_intro_to_notebooks/lab1.html">Week 2: Introduction to Python, Data Visualization, Sampling/Aliasing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Determine your heart rate</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../2_determine_heart_rate/lab2.html">Week 3: Finding Local Max in PPG Signal</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Estimate your blood flow</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../3_estimate_blood_flow/lab3.html">Week 4: Estimate Blood Flow from PPG Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Measure the heights of tall and far away things</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../4_measure_tall_things/a_prepare_for_building_inclinometer/lab4a.html">Week 5: Prep to Build an Inclinometer (Namespaces, Modules, Objects)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../4_measure_tall_things/b_build_an_inclinometer/lab4b.html">Week 6-7: Build an Inclinometer (Objects on Hardware)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../4_measure_tall_things/c_make_the_measurements/lab4c.html">Week 8-9: Measure Heights of Campus Landmarks with Your Inclinometer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../4_measure_tall_things/d_error_analysis/lab4d.html">Week 10: How Accurate is Your Height Measurement? (Derivative Rule for Error Propagation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../4_measure_tall_things/e_symbolic_error/lab4e.html">Week 11: Analyzing the Error Using Symbolic Method (SymPy)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Measure the speeds of nearby things</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Week 12: Prepare to Build a Distance Measurement Tool (Floating Pt Numbers and Num. Differentiation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../b_build_a_tool/lab5b.html">Week 13: Build a Distance Measurement Distance Tool Using an Ultrasonic Sensor (Data Cleaning and Micropython)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Design a project of your own</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../final_project/labfinal.html">Weeks 14-15: Final Project</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extra Materials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../extra_materials/intro_to_breadboards/intro_to_breadboards.html">Extra Materials: Introduction to Breadboards</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/TheDataScienceLabs/DSLab_Calculus" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/TheDataScienceLabs/DSLab_Calculus/issues/new?title=Issue%20on%20page%20%2Flabs/5_measure_speeds/a_derivatives/lab5a.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/labs/5_measure_speeds/a_derivatives/lab5a.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Week 12: Prepare to Build a Distance Measurement Tool (Floating Pt Numbers and Num. Differentiation)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#content"><span style="color:orange;"> 00. Content </span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#required-hardware"><span style="color:orange;"> 0. Required Hardware </span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-types-of-numbers-in-python"><span style="color:orange;"> 1. Two Types of Numbers in Python </span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integers">Integers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#floats">Floats</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-5-pts"><span style="color:red;"> Exercise 1 </span> (5 pts)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubles-with-floating-point-numbers"><span style="color:orange;"> 2. Troubles with Floating Point Numbers </span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-5-pts"><span style="color:red;"> Exercise 2 </span> (5 pts)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#catastrophic-cancellation"><span style="color:orange;"> 3. Catastrophic Cancellation </span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-5-pts"><span style="color:red;"> Exercise 3 </span> (5 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-25-pts"><span style="color:red;"> Exercise 4 </span> (25 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-practical-example-of-catastrophic-cancellation">A practical example of catastrophic cancellation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-differentiation"><span style="color:orange;"> 4. Numerical Differentiation </span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-5-10-pts"><span style="color:red;"> Exercise 5 </span> (10 pts)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-difference-schemes"><span style="color:orange;"> 5. Finite Difference Schemes </span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bias-in-the-forward-difference">Bias in the forward difference</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-6-2-5-pts"><span style="color:red;"> Exercise 6 </span> (2.5 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-7-5-pts"><span style="color:red;"> Exercise 7 </span> (5 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#correcting-the-bias">Correcting the bias</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-8-5-pts"><span style="color:red;"> Exercise 8 </span> (5 pts)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unequal-step-sizes"><span style="color:orange;"> 6. Unequal Step Sizes </span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quick-way-to-figure-out-alpha-beta-and-gamma">A quick way to figure out <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span>, and <span class="math notranslate nohighlight">\(\gamma\)</span>.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-9-5-pts"><span style="color:red;"> Exercise 9 </span> (5 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-10-5-pts"><span style="color:red;"> Exercise 10 </span> (5 pts)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-symmetric-finite-difference-method-with-unequal-step-sizes">The symmetric finite difference method with unequal step sizes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-11-25-pts"><span style="color:red;"> Exercise 11 </span> (25 pts)</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="week-12-prepare-to-build-a-distance-measurement-tool-floating-pt-numbers-and-num-differentiation">
<h1>Week 12: Prepare to Build a Distance Measurement Tool (Floating Pt Numbers and Num. Differentiation)<a class="headerlink" href="#week-12-prepare-to-build-a-distance-measurement-tool-floating-pt-numbers-and-num-differentiation" title="Link to this heading">#</a></h1>
<p><font size="6">  Laboratory 5a </font> <br>
<font size="3"> Last updated April 5, 2023 </font></p>
<section id="content">
<h2><span style="color:orange;"> 00. Content </span><a class="headerlink" href="#content" title="Link to this heading">#</a></h2>
<p><font size="5"> Mathematics </font></p>
<ul class="simple">
<li><p>Approximating derivatives using finite difference schemes</p></li>
<li><p>Approximation bias</p></li>
</ul>
<p><font size="5"> Programming Skills </font></p>
<ul class="simple">
<li><p>Number types: int, float</p></li>
<li><p>Use of underscore as a numerical separator</p></li>
<li><p>Vectorized computation</p></li>
</ul>
<p><font size="5"> Embedded Systems </font></p>
<ul class="simple">
<li><p>N/A</p></li>
</ul>
</section>
<section id="required-hardware">
<h2><span style="color:orange;"> 0. Required Hardware </span><a class="headerlink" href="#required-hardware" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>N/A</p></li>
</ul>
<h3 style="background-color:lightblue"> Copy the file `student_info.py` into the folder you are working in, then run this cell to put your name and email into this document.</h3><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">student_info</span><span class="w"> </span><span class="kn">import</span> <span class="n">show_info</span>
<span class="n">show_info</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="two-types-of-numbers-in-python">
<h2><span style="color:orange;"> 1. Two Types of Numbers in Python </span><a class="headerlink" href="#two-types-of-numbers-in-python" title="Link to this heading">#</a></h2>
</section>
<section id="integers">
<h2>Integers<a class="headerlink" href="#integers" title="Link to this heading">#</a></h2>
<p>One of the benefits of using Python is that it has great support for numbers. This makes it much more friendly for doing math than, for example, Javascript or C. Whole numbers in Python have the type <code class="docutils literal notranslate"><span class="pre">int</span></code>, which is short for Integer. You can check this yourself:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Python <code class="docutils literal notranslate"><span class="pre">int</span></code>s can be as big as you like, positive or negative. It can get a bit cumbersome writing and reading them, and the comma has a special meaning in Python, so you can’t use it to separate big integers for legibility:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">123</span><span class="p">,</span><span class="mi">456</span><span class="p">,</span><span class="mi">789</span>
</pre></div>
</div>
</div>
</div>
<p>That gives us a list of three integers. If you want to refer to the number 123,456,789 you can write it without separations, but it is easier to read if you use the underscore symbol where there would be a comma:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">123_456_789</span> <span class="o">==</span> <span class="mi">123456789</span>
</pre></div>
</div>
</div>
</div>
<p>You can put underscores wherever you like in a number – python ignores them. You could represent a credit card number, for example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">3782_8224_6310_005</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="floats">
<h2>Floats<a class="headerlink" href="#floats" title="Link to this heading">#</a></h2>
<p>The other type of number was mentioned in Lab 4e, floating point numbers. As explained previously, floats are used to represent non-whole numbers like decimals. However, they do present some error since Python can only store a certain amount of digits. For almost all purposes, this relative error is no trouble at all, and if it is posing a problem then the tool introduced last time, SymPy, can be implemented to avoid this.</p>
<section id="exercise-1-5-pts">
<h3><span style="color:red;"> Exercise 1 </span> (5 pts)<a class="headerlink" href="#exercise-1-5-pts" title="Link to this heading">#</a></h3>
<p>For each of the following constants, look them up on Wikipedia or WolframAlpha and report the relative error in their known values using SI units. If an error is not given, you can assume the absolute error is <span class="math notranslate nohighlight">\(\pm 1 \)</span> of the last digit given. Note that some times, the absolute error is given in a concise notation, as described here: <a class="reference external" href="https://physics.nist.gov/cgi-bin/cuu/Info/Constants/definitions.html">https://physics.nist.gov/cgi-bin/cuu/Info/Constants/definitions.html</a>. Compare your answers to the relative error in a floating point number, known as <a class="reference external" href="https://en.wikipedia.org/wiki/Machine_epsilon"><em>machine epsilon</em></a>
(<em>Reminder: we are using single precision floats</em>). Make sure you are using relative error, not absolute error.</p>
<ul class="simple">
<li><p>Mass of an electron</p></li>
<li><p>Orbital period of the moon (the Sidereal period, specifically)</p></li>
<li><p>Distance from New York to Los Angeles</p></li>
<li><p>Freezing point of water at atmospheric pressure</p></li>
</ul>
<h3 style="background-color:lightblue"> Write Answers for Exercise 1 Below: </h3></section>
</section>
<section id="troubles-with-floating-point-numbers">
<h2><span style="color:orange;"> 2. Troubles with Floating Point Numbers </span><a class="headerlink" href="#troubles-with-floating-point-numbers" title="Link to this heading">#</a></h2>
<p>Precision is usually not a problem with floating point numbers, with one major exception which we will address later. The main issue you will face is when comparing numbers. Check this out:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span><span class="o">/</span><span class="mi">10</span> <span class="o">==</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">x</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="exercise-2-5-pts">
<h3><span style="color:red;"> Exercise 2 </span> (5 pts)<a class="headerlink" href="#exercise-2-5-pts" title="Link to this heading">#</a></h3>
<p>Explain why a few numbers are missing from the printout above. Include the python values of <code class="docutils literal notranslate"><span class="pre">x/10</span></code> and <code class="docutils literal notranslate"><span class="pre">0.1*x</span></code> in your explanation, for some values of <code class="docutils literal notranslate"><span class="pre">x</span></code> (make a new code cell printing the relevant values).</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 2 Below </h3><p>There are two main ways to deal with this:</p>
<ol class="arabic simple">
<li><p>Whenever possible, use <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code> instead of <code class="docutils literal notranslate"><span class="pre">==</span></code> when comparing floating point numbers. This is usually the best thing to do. For example, if a number is decreasing and you want to know when it hits zero, check if it is positive instead of checking if it’s zero. Or, better yet, check if it’s less than 0.0001, keeping as much precision as you need for your purpose and no more.</p></li>
<li><p>Instead of checking if floats are equal, check if they are close to eachother. For example, the builtin function <code class="docutils literal notranslate"><span class="pre">math.isclose</span></code> can do this for you, or you can use the version in numpy if working with arrays. Here is how that might look:</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">x</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="catastrophic-cancellation">
<h2><span style="color:orange;"> 3. Catastrophic Cancellation </span><a class="headerlink" href="#catastrophic-cancellation" title="Link to this heading">#</a></h2>
<p>There is one situation where roundoff error is a really big problem. That is when you are subtracting two numbers which are very close together. This isn’t anything special about floating point numbers, this is just a fact about rounding. Here, have a look:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{r}
3.14159265358???\\
-\; 3.14159265332???\\\hline
0.00000000026???
\end{array}
\end{split}\]</div>
<p>We have used question marks to represent unknown digits, i.e. digits which were lost due to rounding. See how the relative error in the output is much bigger than in either of the inputs: each input has 12 significant figures, but the output has only two significant figures. We can do this a bit more precisely by writing the absolute errors explicitly:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
3.14159265358??? &amp;\rightarrow 3.14159265358 \pm 5\times 10^{-12}\\
3.14159265332??? &amp;\rightarrow 3.14159265332 \pm 5\times 10^{-12}\\
0.00000000026??? &amp;\rightarrow 0.00000000026 \pm \text{(you figure this one out)}\\
\end{align*}\]</div>
<section id="exercise-3-5-pts">
<h3><span style="color:red;"> Exercise 3 </span> (5 pts)<a class="headerlink" href="#exercise-3-5-pts" title="Link to this heading">#</a></h3>
<p>What is the absolute error in the output? What are the relative errors of each of the inputs, and what is the relative error of the output?</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 3 Below </h3></section>
<section id="exercise-4-25-pts">
<h3><span style="color:red;"> Exercise 4 </span> (25 pts)<a class="headerlink" href="#exercise-4-25-pts" title="Link to this heading">#</a></h3>
</section>
<section id="a-practical-example-of-catastrophic-cancellation">
<h3>A practical example of catastrophic cancellation<a class="headerlink" href="#a-practical-example-of-catastrophic-cancellation" title="Link to this heading">#</a></h3>
<p>Before continuing, run the following block. This code will be able to check if your code works properly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sh</span>
wget -q -N https://raw.githubusercontent.com/TheDataScienceLabs/DSLab_Calculus/main/book/labs/5_measure_speeds/a_derivatives/autograder.py
wget -q -N https://raw.githubusercontent.com/TheDataScienceLabs/DSLab_Calculus/main/book/labs/5_measure_speeds/a_derivatives/lab_5a_checker.py
</pre></div>
</div>
</div>
</div>
<p>Here we walk you through coding an example where catastrophic cancellation makes a pretty big difference, and something clever you can do to fix it.</p>
<p><strong>Part 1</strong> (5 pts)</p>
<p>Write a function which takes the coefficients <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, and <code class="docutils literal notranslate"><span class="pre">c</span></code> from a polynomial <span class="math notranslate nohighlight">\(ax^2+bx+c\)</span> and gives you a list of the roots. Just apply the standard quadratic formula. For now, you can assume that <span class="math notranslate nohighlight">\(b^2-4ac&gt;0\)</span> so you can take the square root, and you can assume <code class="docutils literal notranslate"><span class="pre">a</span></code> is not zero. Have it give the smaller root first (you can use the built in function <code class="docutils literal notranslate"><span class="pre">sorted</span></code> for this).</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 4 Part 1 Below </h3><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">lab_5a_checker</span>

<span class="k">def</span><span class="w"> </span><span class="nf">naive_roots</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="c1"># fill in the formula here</span>
    
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">])</span>

<span class="n">lab_5a_checker</span><span class="o">.</span><span class="n">check_naive_roots</span><span class="p">(</span><span class="n">naive_roots</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Part 2</strong> (2.5 pts)</p>
<p>Factor the polynomial <span class="math notranslate nohighlight">\(x^2-1,000,000.000,001 x +1\)</span> exactly, on paper (note the decimal place in <code class="docutils literal notranslate"><span class="pre">b</span></code>). What should the roots be?</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 4 Part 2 Below </h3><p><strong>Part 3</strong> (2.5 pts)</p>
<p>Apply your simple root-finding function to this polynomial. What are the relative errors in your computed roots, compared to the true values? Explain why one of these has a larger relative error.</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 4 Part 3 Below </h3><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># call your root finding function</span>
</pre></div>
</div>
</div>
</div>
<p>Here is a simple technique we can apply to reduce the error. Let’s assume for now that <code class="docutils literal notranslate"><span class="pre">b</span></code> is a negative number. So, we get cancellation in the numerator when subtracting <span class="math notranslate nohighlight">\(-b\)</span> and <span class="math notranslate nohighlight">\(\sqrt{b^2-4ac}\)</span>. In this case, just multiply by one in a clever way:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{-b-\sqrt{b^2-4ac}}{2a}
&amp;= \frac{-b-\sqrt{b^2-4ac}}{2a} \times \frac{-b+\sqrt{b^2-4ac}}{-b+\sqrt{b^2-4ac}}\\
&amp;= \frac{b^2-(b^2-4ac)}{2a(-b+\sqrt{b^2-4ac})}\\
&amp;= \frac{2c}{-b+\sqrt{b^2-4ac}}
\end{align*}\]</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">b</span></code> is negative and <code class="docutils literal notranslate"><span class="pre">-b</span></code> is positive, there is no cancellation here! We can use this formula to compute the “-” root, while the original formula will continue to compute the “+” root correctly.</p>
<p><strong>Part 4</strong> (5 pts)</p>
<p>Assuming <code class="docutils literal notranslate"><span class="pre">b</span></code> is always negative, rewrite your function to use this formula for one root and the standard formula for the other root. Compute the relative errors on the example above, using your new formula.</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 4 Part 4 Below </h3><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># rewrite your function</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lab_5a_checker</span>

<span class="k">def</span><span class="w"> </span><span class="nf">naive_roots</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="c1"># fill in the formula here</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">])</span>

<span class="n">lab_5a_checker</span><span class="o">.</span><span class="n">check_improved_naive_roots</span><span class="p">(</span><span class="n">naive_roots</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Part 5</strong> (5 pts)</p>
<p>Figure out a similar formula which works when <code class="docutils literal notranslate"><span class="pre">b</span></code> is always positive. Use both formulas to write a function to compute the roots which is always accurate, and does not suffer from catastrophic cancellation.</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 4 Part 5 Below </h3><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># write a better root finding function</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lab_5a_checker</span>

<span class="k">def</span><span class="w"> </span><span class="nf">naive_roots</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="c1"># fill in the formula here</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">])</span>

<span class="n">lab_5a_checker</span><span class="o">.</span><span class="n">check_improved_naive_roots</span><span class="p">(</span><span class="n">naive_roots</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Part 6</strong> (5 pts)</p>
<p>Finish off your function by adding a special case for if <code class="docutils literal notranslate"><span class="pre">c</span></code> is exactly zero (don’t want to divide by zero, after all!). We have provided a test you can use to check your work.</p>
<h3 style="background-color:lightblue"> Write Answers for Exercise 4 Part 6 Below </h3><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add special cases for a and c</span>
<span class="k">def</span><span class="w"> </span><span class="nf">roots</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="c1"># fill in the formula here</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">])</span>

<span class="n">lab_5a_checker</span><span class="o">.</span><span class="n">check_roots</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This example shows how catastrophic cancellation can occur even in friendly, well-known functions. This also shows that we can usually deal with it, by doing some clever algebra. This is such a common issue that there are now tools available to identify and fix catastrophic cancellation. If you are curious, check out <a class="reference external" href="http://herbie.uwplse.org/">Herbie</a>, which a friend of mine helped to create.</p>
</section>
</section>
<section id="numerical-differentiation">
<h2><span style="color:orange;"> 4. Numerical Differentiation </span><a class="headerlink" href="#numerical-differentiation" title="Link to this heading">#</a></h2>
<p>Now you are prepared to see the major problem we are up against when trying to compute derivatives using floating-point arithmetic. Remember that by definition, the derivative of a function <span class="math notranslate nohighlight">\(f(x)\)</span> is</p>
<div class="math notranslate nohighlight">
\[
f'(x) = \lim_{h\to 0} \frac{f(x+h)-f(x)}{h}
\]</div>
<p>This suggests a simple way to compute a derivative: pick a really small number <span class="math notranslate nohighlight">\(h\)</span>, and compute <span class="math notranslate nohighlight">\(\frac{f(x+h)-f(x)}{h}\)</span>. Since <span class="math notranslate nohighlight">\(h\)</span> is just a small but finite number, this is called the <em>finite difference method</em>.</p>
<section id="exercise-5-10-pts">
<h3><span style="color:red;"> Exercise 5 </span> (10 pts)<a class="headerlink" href="#exercise-5-10-pts" title="Link to this heading">#</a></h3>
<p>Let’s see what happens when we apply this procedure blindly. We will apply this formula for <span class="math notranslate nohighlight">\(f(x)=x^2\)</span> at the point <span class="math notranslate nohighlight">\(x=4\)</span>. The correct derivative should be 8. We will compute the relative error in using the finite difference method, for various values of <span class="math notranslate nohighlight">\(h\)</span>. It is easy to get a good spread of values for <span class="math notranslate nohighlight">\(h\)</span>, in a geometric sequence:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">1e-15</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Part 1</strong> (5 pts)</p>
<p>Make an array giving approximations to <span class="math notranslate nohighlight">\(f'(4)\)</span> for each value of <code class="docutils literal notranslate"><span class="pre">h</span></code>, using the finite difference method. Then, compute the relative error in this approximation using the relative error formula. Tools to check your work are available. You must use arrays and broadcasting to get full credit here.</p>
<h3 style="background-color:lightblue;"> Write Answers for Exercise 5 Part 1 Below </h3><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">approximation</span> <span class="o">=</span> 
<span class="n">relative_error</span> <span class="o">=</span> 
<span class="n">lab_5a_checker</span><span class="o">.</span><span class="n">check_finite_difference</span><span class="p">(</span><span class="n">approximation</span><span class="p">,</span> <span class="n">relative_error</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Part 2</strong> (5 pts)</p>
<p>Now that we have computed the relative error, let’s inspect it in a plot. We will use a logarithmic scale for the x and y axes, which will help us to compare very different values. Since we are taking a logarithm, we must look at the absolute value of the relative error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">relative_error</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;step size $h$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;relative error in computing the finite difference&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>In light of what you have learned today about catastrophic cancellation, explain the shape of the curve you get. Explain why it is not a good idea to just make <span class="math notranslate nohighlight">\(h\)</span> as small as possible. What is the smallest relative error we can achieve using this method?</p>
<h3 style="background-color:lightblue;"> Write Answers for Exercise 5 Part 2 Below </h3></section>
</section>
<section id="finite-difference-schemes">
<h2><span style="color:orange;"> 5. Finite Difference Schemes </span><a class="headerlink" href="#finite-difference-schemes" title="Link to this heading">#</a></h2>
<p>This shows the basic struggle of computing numerical derivatives: the definition of the derivative requires <code class="docutils literal notranslate"><span class="pre">h</span></code> to be infinitely small, but we can’t practically make it that small. This isn’t just because of catastrophic cancellation, by the way – often when working with real data you are limited in how fast you can collect it. Hence, our goal will be to find ways to get more accurate estimates of the derivative without just making the step size <span class="math notranslate nohighlight">\(h\)</span> tiny. We will consider <span class="math notranslate nohighlight">\(h\)</span> to be fixed, and try to get our estimate as good as possible.</p>
<section id="bias-in-the-forward-difference">
<h3>Bias in the forward difference<a class="headerlink" href="#bias-in-the-forward-difference" title="Link to this heading">#</a></h3>
<p>Let’s examine the finite difference method, applied to the function <span class="math notranslate nohighlight">\(f(x) = x^3\)</span> at <span class="math notranslate nohighlight">\(x=2\)</span>. For ease of illustration, let’s choose <span class="math notranslate nohighlight">\(h=0.5\)</span>. Our estimate of <span class="math notranslate nohighlight">\(f'(2)\)</span> is</p>
<div class="math notranslate nohighlight">
\[
f'(2)\approx \frac{(2+0.5)^3-2^3}{0.5}.
\]</div>
<p>Is this an over-estimate or an under-estimate? Let’s draw a picture to help us see.</p>
</section>
<section id="exercise-6-2-5-pts">
<h3><span style="color:red;"> Exercise 6 </span> (2.5 pts)<a class="headerlink" href="#exercise-6-2-5-pts" title="Link to this heading">#</a></h3>
<p><strong>Part 1</strong> (2.5 pts)</p>
<p>Find an equation for the tangent line to <span class="math notranslate nohighlight">\(y=f(x)\)</span> at <span class="math notranslate nohighlight">\(x=2\)</span>.</p>
<p><strong>Part 2</strong> (2.5 pts)</p>
<p>Find an equation for the secant line intersecting <span class="math notranslate nohighlight">\(y=f(x)\)</span> at <span class="math notranslate nohighlight">\(x=2\)</span> and <span class="math notranslate nohighlight">\(x=2.5\)</span>.</p>
<h3 style="background-color:lightblue;"> Write Answers for Exercise 6 Below </h3><p>Fill in the formulas you found for the secant and tangent lines below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>
<span class="n">tangent</span> <span class="o">=</span> <span class="c1">#fill in here</span>
<span class="n">secant</span> <span class="o">=</span> <span class="c1">#fill in here</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cube</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$x^3$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tangent</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;tangent&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">secant</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;secant&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">27</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>That shows it visually: the slope of the secant line is bigger than the slope of the tangent line. We can see it algebraically too:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{(2+0.5)^3-2^3}{0.5}
&amp;=\frac{12(0.5)+6(0.5)^2+(0.5)^3}{0.5}\\
&amp;=12+6(0.5)+(0.5)^2
\end{align*}\]</div>
<p>The correct derivative is 12, and the other terms (most of all the term <span class="math notranslate nohighlight">\(6(0.5)\)</span>) are making it too big.</p>
<p>When we choose <span class="math notranslate nohighlight">\(h\)</span> to be a positive number, we call that a <em>forward difference</em>. What if we try making <span class="math notranslate nohighlight">\(h\)</span> negative, doing a so-called <em>backward difference</em>? Try that now.</p>
</section>
<section id="exercise-7-5-pts">
<h3><span style="color:red;"> Exercise 7 </span> (5 pts)<a class="headerlink" href="#exercise-7-5-pts" title="Link to this heading">#</a></h3>
<p><strong>Part 1</strong> (2.5 pts)</p>
<p>Create a similar plot to show what happens if <span class="math notranslate nohighlight">\(h=-0.5\)</span>.</p>
<p><strong>Part 2</strong> (2.5 pts)</p>
<p>Is the slope of the secant line too big, or too small, in this case? Support your claim using your figure. How is this related to the curvature of the function <span class="math notranslate nohighlight">\(f(x)=x^3\)</span>?</p>
<h3 style="background-color:lightblue;"> Write Answers for Exercise 7 Part 1 Below </h3><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>
<span class="n">tangent</span> <span class="o">=</span> <span class="c1">#fill in here</span>
<span class="n">secant</span> <span class="o">=</span> <span class="c1">#fill in here</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cube</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$x^3$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tangent</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;tangent&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">secant</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;secant&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">27</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<h3 style="background-color:lightblue;"> Write Answers for Exercise 7 Part 2 Below </h3></section>
<section id="correcting-the-bias">
<h3>Correcting the bias<a class="headerlink" href="#correcting-the-bias" title="Link to this heading">#</a></h3>
<p>As you have noticed, the forward difference gave us an over-estimate while the backward difference gave an under-estimate. This gives us a clear way to do better: we could average these answers out, which would give us a (hopefully) unbiased answer. Algebraically, this would look something like this:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{1}{2}\left[ \frac{f(x+h) - f(x)}{h} + \frac{f(x-h)-f(x)}{-h} \right]
&amp;= \frac{f(x+h)-f(x)-f(x-h) + f(x)}{2h}\\
&amp;= \frac{f(x+h)-f(x-h)}{2h}
\end{align*}\]</div>
<p>This is the <em>symmetric difference</em> scheme. You can think of it as a secant line which doesn’t go through a given point, but rather goes through its neighbors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>
<span class="n">tangent</span> <span class="o">=</span> <span class="mi">12</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span>
<span class="n">secant</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.5</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="mf">1.5</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">1.5</span><span class="p">)</span><span class="o">+</span><span class="mf">1.5</span><span class="o">**</span><span class="mi">3</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cube</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$x^3$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tangent</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;tangent&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">secant</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;secant&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">27</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>No obvious bias! We can still work out algebraically that it’s not exact:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{(2+0.5)^3 - (2-0.5)^3}{2*(0.5)} = 12.25
\end{align*}\]</div>
<p>This is still a slight overestimate. However, it’s clearly way better for any given step size <span class="math notranslate nohighlight">\(h\)</span>. The error gets small really fast, too: if we instead had <span class="math notranslate nohighlight">\(h=10^{-9}\)</span>, the error would be just <span class="math notranslate nohighlight">\((10^{-9})^2 = 10^{-18}\)</span>, which is smaller than the floating-point error. Symmetric difference is better than forward difference!</p>
</section>
<section id="exercise-8-5-pts">
<h3><span style="color:red;"> Exercise 8 </span> (5 pts)<a class="headerlink" href="#exercise-8-5-pts" title="Link to this heading">#</a></h3>
<p>Work out the symmetric difference exactly on paper for the function <span class="math notranslate nohighlight">\(f(x)=5x^2+3x-7\)</span>, for a variable step size <span class="math notranslate nohighlight">\(h\)</span>, at the point <span class="math notranslate nohighlight">\(x=2\)</span>. Find the relative error algebraically, and comment on it.</p>
<h3 style="background-color:lightblue;"> Write Answers for Exercise 8 Below </h3></section>
</section>
<section id="unequal-step-sizes">
<h2><span style="color:orange;"> 6. Unequal Step Sizes </span><a class="headerlink" href="#unequal-step-sizes" title="Link to this heading">#</a></h2>
<p>In Exercise 8 you should have found that the symmetric difference scheme gave exactly the right answer. This is not just a coincidence. Whenever your function is a quadratic polynomial, the symmetric finite difference scheme gives exactly the correct answer. A scheme with this property is called <strong>second-order accurate</strong>.</p>
<p>The symmetric finite difference scheme is a very powerful way to estimate derivatives. It’s a second-order accurate scheme, and it only uses two points to estimate the derivative. Unfortunately, it only works when the step sizes are equal, that is, when the samples are evenly spaced. Frequently we are not so lucky as to have evenly spaced samples. Data often arrive whenever they are available, and we have to deal with that. Fortunately, we can still get a second-order accurate scheme, even if the step sizes are unequal. In this section, we will develop a second-order accurate scheme to estimate the derivative of a function at a point <span class="math notranslate nohighlight">\(x=b\)</span> using nearby points <span class="math notranslate nohighlight">\(x=a\)</span> to the left and <span class="math notranslate nohighlight">\(x=c\)</span> to the right, so <span class="math notranslate nohighlight">\(a&lt;b&lt;c\)</span>. That is, we will find numbers <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span>, and <span class="math notranslate nohighlight">\(\gamma\)</span> such that</p>
<div class="math notranslate nohighlight">
\[
f'(b) = \alpha f(a) + \beta f(b) + \gamma f(c) \tag{$*$}
\]</div>
<p>whenever <span class="math notranslate nohighlight">\(f(x)\)</span> is a quadratic polynomial. These numbers should depend on <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(b\)</span>, and <span class="math notranslate nohighlight">\(c\)</span>, but they shouldn’t depend on <span class="math notranslate nohighlight">\(f\)</span>. There are many ways we could figure out the formulas for <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span>, and <span class="math notranslate nohighlight">\(\gamma\)</span>. Next we will walk you through one of the simplest ways.</p>
</section>
<section id="a-quick-way-to-figure-out-alpha-beta-and-gamma">
<h2>A quick way to figure out <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span>, and <span class="math notranslate nohighlight">\(\gamma\)</span>.<a class="headerlink" href="#a-quick-way-to-figure-out-alpha-beta-and-gamma" title="Link to this heading">#</a></h2>
<p>We know that <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span>, and <span class="math notranslate nohighlight">\(\gamma\)</span> will not depend on <span class="math notranslate nohighlight">\(f\)</span>. For some values of <span class="math notranslate nohighlight">\(f\)</span>, the values of <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span>, and <span class="math notranslate nohighlight">\(\gamma\)</span> will be obvious. For example, let’s say we choose <span class="math notranslate nohighlight">\(f(x)=(x-b)(x-c)\)</span>. We can just evaluate each term in (<span class="math notranslate nohighlight">\(*\)</span>) directly.</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
f'(x) &amp;= 2x-b-c\\
f'(b) &amp;= b-c\\
f(a) &amp;= (a-b)(a-c)\\
f(b) &amp;= (b-b)(b-c)=0\\
f(c) &amp;= (c-b)(c-c)=0
\end{align*}\]</div>
<p>By substituting these values, equation (<span class="math notranslate nohighlight">\(*\)</span>) becomes</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
b-c &amp;= \alpha (a-b)(a-c)\\
\alpha &amp;= \frac{b-c}{(a-b)(a-c)}\\
&amp;= \frac{1}{c-a}-\frac{1}{b-a}
\end{align*}\]</div>
<p>By choosing <span class="math notranslate nohighlight">\(f\)</span> carefully, we were able to get the value of <span class="math notranslate nohighlight">\(\alpha\)</span> directly. The trick was to choose <span class="math notranslate nohighlight">\(f\)</span> so that the terms <span class="math notranslate nohighlight">\(f(a)\)</span> and <span class="math notranslate nohighlight">\(f(c)\)</span> worked out to be zero.</p>
<p>We will work out how to find <span class="math notranslate nohighlight">\(\alpha\)</span> together as another example. Then, you will be asked to choose <span class="math notranslate nohighlight">\(f\)</span> to give you <span class="math notranslate nohighlight">\(\gamma\)</span>. Since I want <span class="math notranslate nohighlight">\(f(a)=0\)</span> and <span class="math notranslate nohighlight">\(f(c)=0\)</span>, I will choose <span class="math notranslate nohighlight">\(f(x)=(x-a)(x-c)\)</span>. This quadratic has zeros at <span class="math notranslate nohighlight">\(x=a\)</span> and <span class="math notranslate nohighlight">\(x=c\)</span>, which is just what I want. Then I can fill out the values as before.</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
f'(x) &amp;= 2x-a-c\\
f'(b) &amp;= 2b-a-c\\
f(a) &amp;= (a-a)(a-c)=0\\
f(b) &amp;= (b-a)(b-c)\\
f(c) &amp;= (c-a)(c-c)=0
\end{align*}\]</div>
<p>By substituting these values, equation (<span class="math notranslate nohighlight">\(*\)</span>) becomes</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
2b-a-c &amp;= \beta(b-a)(b-c)\\
\beta &amp;= \frac{2b-a-c}{(b-a)(b-c)}\\
&amp;= \frac{1}{b-a}-\frac{1}{c-b}
\end{align*}\]</div>
<section id="exercise-9-5-pts">
<h3><span style="color:red;"> Exercise 9 </span> (5 pts)<a class="headerlink" href="#exercise-9-5-pts" title="Link to this heading">#</a></h3>
<p>Choose a symbolic quadratic polynomial <span class="math notranslate nohighlight">\(f(x)\)</span> so that when you substitute <span class="math notranslate nohighlight">\(f(x)\)</span> into (<span class="math notranslate nohighlight">\(*\)</span>), you find the value of <span class="math notranslate nohighlight">\(\gamma\)</span> using the method demonstrated above. For your choice of <span class="math notranslate nohighlight">\(f(x)\)</span>, copy the following table into your answer and fill it out.</p>
<div class="highlight-latex notranslate"><div class="highlight"><pre><span></span><span class="k">\begin</span><span class="nb">{</span>align*<span class="nb">}</span>
f(x)  <span class="nb">&amp;</span>=     <span class="k">\\</span>
f&#39;(x) <span class="nb">&amp;</span>=     <span class="k">\\</span>
f&#39;(b) <span class="nb">&amp;</span>=     <span class="k">\\</span>
f(a)  <span class="nb">&amp;</span>=     <span class="k">\\</span>
f(b)  <span class="nb">&amp;</span>=     <span class="k">\\</span>
f(c)  <span class="nb">&amp;</span>= 
<span class="k">\end</span><span class="nb">{</span>align*<span class="nb">}</span>
</pre></div>
</div>
<p>Then, substitute the values into (<span class="math notranslate nohighlight">\(*\)</span>) and write that equation in your answer as well. Solve the equation for <span class="math notranslate nohighlight">\(\gamma\)</span> in terms of <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(b\)</span>, and <span class="math notranslate nohighlight">\(c\)</span>. You should find that</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\gamma = \frac{1}{c-b}-\frac{1}{c-a}.
\end{align*}\]</div>
<h3 style="background-color:lightblue;"> Write Answers for Exercise 9 Below </h3></section>
<section id="exercise-10-5-pts">
<h3><span style="color:red;"> Exercise 10 </span> (5 pts)<a class="headerlink" href="#exercise-10-5-pts" title="Link to this heading">#</a></h3>
<p>Substitute <span class="math notranslate nohighlight">\(f(x)=1\)</span> in (<span class="math notranslate nohighlight">\(*\)</span>). What relationship do you find between <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span>, and <span class="math notranslate nohighlight">\(\gamma\)</span>? Substitute the formulas we found for <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span>, and <span class="math notranslate nohighlight">\(\gamma\)</span> into that expression to verify that our answers are correct.</p>
<h3 style="background-color:lightblue;"> Write Answers for Exercise 10 Below </h3></section>
</section>
<section id="the-symmetric-finite-difference-method-with-unequal-step-sizes">
<h2>The symmetric finite difference method with unequal step sizes<a class="headerlink" href="#the-symmetric-finite-difference-method-with-unequal-step-sizes" title="Link to this heading">#</a></h2>
<p>Suppose we have three x-values <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(b\)</span>, and <span class="math notranslate nohighlight">\(c\)</span> with <span class="math notranslate nohighlight">\(a&lt;b&lt;c\)</span>. Suppose further that we have measured <span class="math notranslate nohighlight">\(f(a)\)</span>, <span class="math notranslate nohighlight">\(f(b)\)</span>, and <span class="math notranslate nohighlight">\(f(c)\)</span>. We now have a good way to approximate the derivative of <span class="math notranslate nohighlight">\(f\)</span> at <span class="math notranslate nohighlight">\(b\)</span>. We compute</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\alpha &amp;=\frac{1}{c-a}-\frac{1}{b-a}\\
\beta  &amp;=\frac{1}{b-a}-\frac{1}{c-b}\\
\gamma &amp;=\frac{1}{c-b}-\frac{1}{c-a}\\
f'(b) &amp;\approx \alpha f(a) +\beta f(b) + \gamma f(c)
\end{align*}\]</div>
<p>The final exercise for today walks you through the process of creating a vectorized version of this formula, which computes the symmetric difference scheme for unequal step sizes in a way that is</p>
<ol class="arabic simple">
<li><p>Efficient (very fast to perform)</p></li>
<li><p>Easy to read (easy to see that it does what it should).</p></li>
</ol>
<section id="exercise-11-25-pts">
<h3><span style="color:red;"> Exercise 11 </span> (25 pts)<a class="headerlink" href="#exercise-11-25-pts" title="Link to this heading">#</a></h3>
<p>Our function will take two arguments, <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>, each of which is an array. The idea is that <span class="math notranslate nohighlight">\(y\)</span> will have the <span class="math notranslate nohighlight">\(f(x)\)</span> values corresponding to each <span class="math notranslate nohighlight">\(x\)</span> value. It will produce an array of the same shape which has the symmetric finite difference scheme applied to find the first derivative.</p>
<p>When working out a procedure, it is a good idea to have an example at hand so you can follow through the steps. Let’s pick some examples for <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">50.0</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">34</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can see that the derivative is steeply negative, leveling at the end. That gives us an idea of what we are looking for: our answer will be an array of negative numbers.</p>
<p>In order to make the function we are writing more legible, we will use the same symbols that are in the derivation we did above. Since we want <span class="math notranslate nohighlight">\(f'(x)\)</span> and our approximation gives us <span class="math notranslate nohighlight">\(f'(b)\)</span>, we can just choose <span class="math notranslate nohighlight">\(b=x\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<p>We want <span class="math notranslate nohighlight">\(a\)</span> to be the number to the left of <span class="math notranslate nohighlight">\(b\)</span>. So, let’s build an array which has all the same numbers as <span class="math notranslate nohighlight">\(x\)</span> but shifted one to the right. Since the leftmost <span class="math notranslate nohighlight">\(x\)</span> has no neighbor to the left, we should instead say that value is missing using the special value <code class="docutils literal notranslate"><span class="pre">nan</span></code>. Here is a quick way to do that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can see that where <code class="docutils literal notranslate"><span class="pre">b</span></code> has the value <code class="docutils literal notranslate"><span class="pre">7</span></code>, for example, <code class="docutils literal notranslate"><span class="pre">a</span></code> has the value <code class="docutils literal notranslate"><span class="pre">5</span></code> and <code class="docutils literal notranslate"><span class="pre">5</span></code> is the number to the left of <code class="docutils literal notranslate"><span class="pre">7</span></code>. Each column corresponds to the values of <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> at one place in our answer.</p>
<p>Step by step, what we did here was to make an array the same shape as <code class="docutils literal notranslate"><span class="pre">x</span></code> but full of the special value <code class="docutils literal notranslate"><span class="pre">nan</span></code>. Then, we took the spots of <code class="docutils literal notranslate"><span class="pre">a</span></code> starting after the first one, and filled them with values from <code class="docutils literal notranslate"><span class="pre">x</span></code> stopping before the last value of <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
<p>We will do the same thing to write <code class="docutils literal notranslate"><span class="pre">c</span></code>, but shifting the values in the other direction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">c</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have those variables set up, we can compute <code class="docutils literal notranslate"><span class="pre">alpha</span></code>, <code class="docutils literal notranslate"><span class="pre">beta</span></code>, and <code class="docutils literal notranslate"><span class="pre">gamma</span></code> without needing any loops. Numpy will automatically compute each column for us using broadcasting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Numpy even automatically filled in the values at the ends with <code class="docutils literal notranslate"><span class="pre">nan</span></code>, because we don’t have neighbors there to compute the symmetric difference.</p>
<p><strong>Part 1</strong> (5 pts)</p>
<p>Compute <code class="docutils literal notranslate"><span class="pre">gamma</span></code> as well, using broadcasting.</p>
<h3 style="background-color:lightblue;"> Write Answers for Exercise 11 Part 1 Below </h3><p>We also need the values of <span class="math notranslate nohighlight">\(f(a)\)</span>, <span class="math notranslate nohighlight">\(f(b)\)</span>, and <span class="math notranslate nohighlight">\(f(c)\)</span>. We will build those just like we built <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, and <code class="docutils literal notranslate"><span class="pre">c</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="n">fa</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">fb</span> <span class="o">=</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Part 2</strong> (5 pts)</p>
<p>Build an array <code class="docutils literal notranslate"><span class="pre">fc</span></code> which holds the values of <span class="math notranslate nohighlight">\(f(c)\)</span>.</p>
<h3 style="background-color:lightblue;"> Write Answers for Exercise 11 Part 2 Below </h3><p>Now that we have all of our variables set up, computing the derivative is as simple as applying the formula (<span class="math notranslate nohighlight">\(*\)</span>) from above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">derivative</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">fa</span><span class="o">+</span><span class="n">beta</span><span class="o">*</span><span class="n">fb</span><span class="o">+</span><span class="n">gamma</span><span class="o">*</span><span class="n">fc</span>
<span class="nb">print</span><span class="p">(</span><span class="n">derivative</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>What should we do about the missing values? Since we can’t do a symmetric difference, the next best thing is a one-sided difference. Since there are just two of these, we can fill them out manually.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">derivative</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">derivative</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Part 3</strong> (5 pts)</p>
<p>Set the last entry of <code class="docutils literal notranslate"><span class="pre">derivative</span></code> similarly. Use negative indices, so that you don’t need to know how many elements are in the array.</p>
<h3 style="background-color:lightblue;"> Write Answers for Exercise 11 Part 3 Below </h3><p><strong>Part 4</strong> (5 pts)</p>
<p>Write a function called <code class="docutils literal notranslate"><span class="pre">symmetric_difference</span></code> which computes the symmetric difference for unequal step sizes. You can do this by copying code line-by-line from above – all the code we wrote should work just fine using an arbitrary <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
<h3 style="background-color:lightblue;"> Write Answers for Exercise 11 Part 4 Below </h3><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">symmetric_difference</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="c1">#write a function here!</span>
    
    <span class="k">return</span> <span class="n">derivative</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">lab_5a_checker</span><span class="o">.</span><span class="n">check_symmetric_difference</span><span class="p">(</span><span class="n">symmetric_difference</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Part 5</strong> (5 pts)</p>
<p>In a language like Python (or Julia, or Matlab, for that matter) a so-called “vectorized” procedure goes way faster than looping through the variables, because you can pass all the difficult computation to highly-optimized code (in our case, the code which comes in the package <code class="docutils literal notranslate"><span class="pre">numpy</span></code>). The difference in speed is very small for arrays without very many entries, but when we start to have hundreds or thousands of entries in our arrays it makes a huge difference. That is one reason why people often prefer to write functions which treat the data as arrays, rather than looping through lists like you would do in other languages like C, Java, or Javascript.</p>
<p>Another reason is that many people find the code easier to read, and easier to understand, if it is written in a vectorized way.</p>
<p>Write a few sentences of your thoughts on the matter. Do you find the function <code class="docutils literal notranslate"><span class="pre">symmetric_difference</span></code> you wrote to be easier to read than if it were done with a loop? Which parts are harder to read, which parts easier? Give your honest opinion.</p>
<h3 style="background-color:lightblue;"> Write Answers for Exercise 11 Part 4 Below </h3></section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./labs/5_measure_speeds/a_derivatives"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../../4_measure_tall_things/e_symbolic_error/lab4e.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Week 11: Analyzing the Error Using Symbolic Method (SymPy)</p>
      </div>
    </a>
    <a class="right-next"
       href="../b_build_a_tool/lab5b.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Week 13: Build a Distance Measurement Distance Tool Using an Ultrasonic Sensor (Data Cleaning and Micropython)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#content"><span style="color:orange;"> 00. Content </span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#required-hardware"><span style="color:orange;"> 0. Required Hardware </span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-types-of-numbers-in-python"><span style="color:orange;"> 1. Two Types of Numbers in Python </span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integers">Integers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#floats">Floats</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-5-pts"><span style="color:red;"> Exercise 1 </span> (5 pts)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubles-with-floating-point-numbers"><span style="color:orange;"> 2. Troubles with Floating Point Numbers </span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-5-pts"><span style="color:red;"> Exercise 2 </span> (5 pts)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#catastrophic-cancellation"><span style="color:orange;"> 3. Catastrophic Cancellation </span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-5-pts"><span style="color:red;"> Exercise 3 </span> (5 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-25-pts"><span style="color:red;"> Exercise 4 </span> (25 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-practical-example-of-catastrophic-cancellation">A practical example of catastrophic cancellation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-differentiation"><span style="color:orange;"> 4. Numerical Differentiation </span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-5-10-pts"><span style="color:red;"> Exercise 5 </span> (10 pts)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-difference-schemes"><span style="color:orange;"> 5. Finite Difference Schemes </span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bias-in-the-forward-difference">Bias in the forward difference</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-6-2-5-pts"><span style="color:red;"> Exercise 6 </span> (2.5 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-7-5-pts"><span style="color:red;"> Exercise 7 </span> (5 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#correcting-the-bias">Correcting the bias</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-8-5-pts"><span style="color:red;"> Exercise 8 </span> (5 pts)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unequal-step-sizes"><span style="color:orange;"> 6. Unequal Step Sizes </span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quick-way-to-figure-out-alpha-beta-and-gamma">A quick way to figure out <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span>, and <span class="math notranslate nohighlight">\(\gamma\)</span>.</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-9-5-pts"><span style="color:red;"> Exercise 9 </span> (5 pts)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-10-5-pts"><span style="color:red;"> Exercise 10 </span> (5 pts)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-symmetric-finite-difference-method-with-unequal-step-sizes">The symmetric finite difference method with unequal step sizes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-11-25-pts"><span style="color:red;"> Exercise 11 </span> (25 pts)</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mireille Boutin, Alden Bradford
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>